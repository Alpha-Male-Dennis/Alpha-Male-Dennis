name: Debug Animated Snake

on:
  workflow_dispatch:

env:
  USERNAME: "Alpha-Male-Dennis"
  THEME: "cyberpunk"

jobs:
  generate-snake:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install --upgrade pip setuptools wheel

      - name: Create and run simple test script
        run: |
          echo "Creating test Python script..."
          
          cat > test_simple.py << 'EOF'
          import sys
          import datetime
          
          print("Python version:", sys.version)
          print("Current time:", datetime.datetime.now())
          print("Test successful!")
          
          # Try basic SVG generation
          with open("test.svg", "w") as f:
              f.write('''<svg width="100" height="100">
                <rect width="100" height="100" fill="blue"/>
                <circle cx="50" cy="50" r="40" fill="red"/>
              </svg>''')
          print("Created test.svg")
          EOF
          
          python test_simple.py
          
          ls -la *.svg

      - name: Create and run debug snake script
        run: |
          echo "Creating debug snake script..."
          
          cat > debug_snake.py << 'EOF'
          import sys
          import datetime
          import math
          import random
          
          print("=== DEBUG SNAKE GENERATOR ===")
          print("Python version:", sys.version)
          
          # Test basic functionality
          try:
              # Test 1: Basic math
              print("Test 1 - Math: sin(1) =", math.sin(1))
              
              # Test 2: Random
              print("Test 2 - Random:", random.randint(1, 100))
              
              # Test 3: Dataclasses
              from dataclasses import dataclass
              @dataclass
              class TestClass:
                  x: int
                  y: str
              
              test_obj = TestClass(10, "hello")
              print("Test 3 - Dataclasses:", test_obj)
              
              # Test 4: HTML escape
              import html
              print("Test 4 - HTML escape:", html.escape("<div>test</div>"))
              
              # Test 5: Create simple SVG
              username = "Alpha-Male-Dennis"
              date_str = datetime.datetime.utcnow().strftime("%Y-%m-%d %H:%M UTC")
              
              svg_content = f'''<?xml version="1.0" encoding="UTF-8"?>
          <svg width="1000" height="400" viewBox="0 0 1000 400">
            <rect width="100%" height="100%" fill="#0a0e17"/>
            <text x="500" y="200" text-anchor="middle" fill="#00ff9d" font-size="24">
              {html.escape(username)}'s Snake - {html.escape(date_str)}
            </text>
            <circle cx="500" cy="200" r="50" fill="#ff0055"/>
          </svg>'''
              
              with open("debug_snake.svg", "w", encoding="utf-8") as f:
                  f.write(svg_content)
              print("Test 5 - Created debug_snake.svg")
              
              # Test 6: JSON
              import json
              data = {"test": "success", "time": date_str}
              with open("debug.json", "w") as f:
                  json.dump(data, f)
              print("Test 6 - Created debug.json")
              
              print("=== ALL TESTS PASSED ===")
              
          except Exception as e:
              print(f"=== ERROR: {type(e).__name__} ===")
              print(f"Error message: {str(e)}")
              print(f"Error at line: {sys.exc_info()[-1].tb_lineno}")
              sys.exit(1)
          EOF
          
          echo "Running debug script..."
          python debug_snake.py
          
          echo "Generated files:"
          ls -la *.svg *.json *.py

      - name: Upload debug artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: debug-files
          path: |
            *.svg
            *.json
            *.py
          retention-days: 1
