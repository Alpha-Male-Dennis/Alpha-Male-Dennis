name: Generate Advanced Snake Animation

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
    inputs:
      theme:
        description: "Animation theme"
        required: false
        default: "cyberpunk"

env:
  USERNAME: "Alpha-Male-Dennis"
  THEME: ${{ github.event.inputs.theme || 'cyberpunk' }}

jobs:
  generate-snake:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip

      - name: Generate snake animation
        run: |
          cat > generate_snake.py << 'EOF'
          import datetime
          import math
          import random
          import json
          import html
          from dataclasses import dataclass
          from typing import List

          @dataclass
          class Theme:
              name: str
              bg_color: str
              snake_colors: List[str]
              block_colors: List[str]
              text_color: str
              accent_color: str
              glow_color: str

          @dataclass
          class Block:
              x: float
              y: float
              size: float
              color: str
              value: int
              type: str

          class AdvancedSnakeGenerator:
              def __init__(self, username: str, theme_name: str):
                  self.username = username
                  self.width = 1000
                  self.height = 400
                  self.themes = self._init_themes()
                  self.theme = self.themes.get(theme_name, self.themes["cyberpunk"])
                  self.blocks = []
                  self.snake_path = []
                  self.date_str = datetime.datetime.utcnow().strftime("%Y-%m-%d %H:%M UTC")

              def _init_themes(self):
                  return {
                      "cyberpunk": Theme(
                          "cyberpunk",
                          "#0a0e17",
                          ["#00ff9d", "#00b8ff", "#9d00ff"],
                          ["#ff0055", "#ffaa00", "#00ffaa", "#aa00ff"],
                          "#ffffff",
                          "#00ff9d",
                          "#00ff9d"
                      ),
                      "github": Theme(
                          "github",
                          "#0d1117",
                          ["#58a6ff", "#8b949e", "#238636"],
                          ["#f78166", "#56d364", "#e3b341", "#8b949e"],
                          "#f0f6fc",
                          "#58a6ff",
                          "#58a6ff"
                      ),
                      "matrix": Theme(
                          "matrix",
                          "#001100",
                          ["#00ff41", "#008f11", "#003b00"],
                          ["#00ff41", "#007700", "#00aa00", "#003300"],
                          "#00ff41",
                          "#00ff41",
                          "#00ff41"
                      )
                  }

              def generate_snake_path(self):
                  points = []
                  for i in range(20):
                      x = 100 + i * 40
                      y = 200 + 60 * math.sin(i * 0.5)
                      points.append((x, y))

                  path = f"M {points[0][0]} {points[0][1]}"
                  for i in range(1, len(points)):
                      path += f" L {points[i][0]} {points[i][1]}"

                  self.snake_path = points
                  return path

              def generate_blocks(self):
                  types = [
                      ("points", 100, 8),
                      ("power", 250, 10),
                      ("bonus", 500, 12),
                      ("special", 1000, 14)
                  ]
                  for _ in range(15):
                      t, v, s = random.choice(types)
                      self.blocks.append(
                          Block(
                              random.randint(120, 880),
                              random.randint(100, 300),
                              s,
                              random.choice(self.theme.block_colors),
                              v,
                              t
                          )
                      )

              def generate_svg(self):
                  path = self.generate_snake_path()
                  self.generate_blocks()

                  u = html.escape(self.username)
                  d = html.escape(self.date_str)

                  return f'''<?xml version="1.0" encoding="UTF-8"?>
          <svg xmlns="http://www.w3.org/2000/svg" width="{self.width}" height="{self.height}" viewBox="0 0 {self.width} {self.height}">
            <style>
              @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&amp;family=Inter:wght@300;400;600&amp;display=swap');
              .header {{ font-family: Orbitron, sans-serif; font-weight: 900; }}
              .stats {{ font-family: Inter, sans-serif; }}
            </style>

            <rect width="100%" height="100%" fill="{self.theme.bg_color}"/>

            <text x="500" y="40" text-anchor="middle" class="header" font-size="32" fill="{self.theme.accent_color}">
              {u}'s GitHub Snake
            </text>

            <text x="500" y="65" text-anchor="middle" class="stats" font-size="14" fill="{self.theme.text_color}">
              Updated {d}
            </text>

            <path d="{path}" fill="none" stroke="{self.theme.accent_color}" stroke-width="6" stroke-linecap="round"/>

            {''.join(f'<circle cx="{b.x}" cy="{b.y}" r="{b.size}" fill="{b.color}"/>' for b in self.blocks)}
          </svg>'''

              def save(self):
                  svg = self.generate_svg()
                  with open("snake.svg", "w", encoding="utf-8") as f:
                      f.write(svg)

                  with open("blocks_data.json", "w") as f:
                      json.dump({"blocks": len(self.blocks)}, f)

          if __name__ == "__main__":
              gen = AdvancedSnakeGenerator("Alpha-Male-Dennis", "cyberpunk")
              gen.save()
          EOF

          python generate_snake.py

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: output
