name: Generate Snake Animation

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pages: write
      id-token: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Generate contribution SVG
        run: |
          # Create a simple script to generate a snake-like SVG
          cat > generate-snake.js << 'EOF'
          const fs = require('fs');
          const https = require('https');
          
          // Simple SVG template
          const svgTemplate = (username, date) => `
          <svg xmlns="http://www.w3.org/2000/svg" width="800" height="120" viewBox="0 0 800 120">
            <style>
              .background { fill: #0d1117; }
              .title { fill: #ffffff; font-family: Arial, sans-serif; font-size: 24px; }
              .subtitle { fill: #cccccc; font-family: Arial, sans-serif; font-size: 16px; }
              .snake-path { fill: none; stroke: #00ff00; stroke-width: 3; }
              .grid-line { fill: none; stroke: #30363d; stroke-width: 1; }
            </style>
            
            <rect class="background" width="800" height="120"/>
            
            <!-- Title -->
            <text class="title" x="400" y="40" text-anchor="middle">GitHub Contributions Snake</text>
            <text class="subtitle" x="400" y="70" text-anchor="middle">For ${username} • Generated on ${date}</text>
            
            <!-- Simple snake-like path -->
            <path class="snake-path" d="M 50,90 Q 150,50 250,90 Q 350,130 450,90 Q 550,50 650,90 Q 750,130 750,90" />
            
            <!-- Grid lines -->
            <path class="grid-line" d="M 0,90 L 800,90" />
            <path class="grid-line" d="M 0,30 L 800,30" />
            <path class="grid-line" d="M 0,60 L 800,60" />
          </svg>
          `;
          
          const username = 'Alpha-Male-Dennis';
          const date = new Date().toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
          });
          
          const svg = svgTemplate(username, date);
          fs.writeFileSync('snake.svg', svg);
          console.log('Generated snake.svg');
          EOF
          
          node generate-snake.js
          
      - name: Verify SVG file
        run: |
          echo "=== Checking generated snake.svg ==="
          if [ -f "snake.svg" ]; then
            echo "✓ snake.svg generated successfully!"
            echo "File size: $(wc -c < snake.svg) bytes"
            echo "First 5 lines:"
            head -5 snake.svg
          else
            echo "✗ snake.svg not found!"
            # Create a fallback SVG
            echo '<?xml version="1.0" encoding="UTF-8"?>
            <svg xmlns="http://www.w3.org/2000/svg" width="800" height="100">
              <rect width="800" height="100" fill="#0d1117"/>
              <text x="400" y="50" text-anchor="middle" font-family="Arial" font-size="20" fill="white">GitHub Contributions Snake - Alpha-Male-Dennis</text>
            </svg>' > snake.svg
          fi
          
      - name: Deploy to output branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: output
          keep_files: false
          force_orphan: true
